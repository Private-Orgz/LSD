@{
    ViewData["Title"] = "Home Page";
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>My Razor View</title>
    <link rel="stylesheet" href="~/css/site.css" />
</head>
<body>
    <div class="LSD table">
        <div class="table-cell">
            <div class="modal">
                <div id="profile">
                    <div class="dashes"></div>
                    <label>Click to browse or drag an image here</label>
                </div>
                <form id="imageUploadForm" enctype="multipart/form-data">
                    <button type="submit">Upload</button>
                    <h2 id="resultMessage" style="text-align:center; margin-top: 10px"></h2>
                </form>
            </div>
        </div>
    </div>
    <input type="file" id="mediaFile" />
</body>
</html>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            debugger;
            $("#imageUploadForm").submit(function (e) {
                e.preventDefault();
                var formData = new FormData();
                formData.append("image", $("#mediaFile")[0].files[0]);

                $.ajax({
                    url: '/Home/UploadImage',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        $("#resultMessage").text(response.message);
                    },
                    error: function () {
                        $("#resultMessage").text("Error uploading image");
                    }
                });
            });
        });
    </script>
    <Script>

        $(function () {

            $('#profile').addClass('dragging').removeClass('dragging');
        });

        $('#profile').on('dragover', function () {
            $('#profile').addClass('dragging')
        }).on('dragleave', function () {
            $('#profile').removeClass('dragging')
        }).on('drop', function (e) {
            $('#profile').removeClass('dragging hasImage');

            if (e.originalEvent) {
                var file = e.originalEvent.dataTransfer.files[0];
                console.log(file);

                var reader = new FileReader();
                //attach event handlers here...

                reader.readAsDataURL(file);
                reader.onload = function (e) {
                    console.log(reader.result);
                    $('#profile').css('background-image', 'url(' + reader.result + ')').addClass('hasImage');

                }
            }
        })
        $('#profile').on('click', function (e) {
            console.log('clicked')
            $('#mediaFile').click();
        });
        window.addEventListener("dragover", function (e) {
            e = e || event;
            e.preventDefault();
        }, false);
        window.addEventListener("drop", function (e) {
            e = e || event;
            e.preventDefault();
        }, false);
        $('#mediaFile').change(function (e) {
            debugger

            var input = e.target;
            if (input.files && input.files[0]) {
                var file = input.files[0];

                var reader = new FileReader();

                reader.readAsDataURL(file);
                reader.onload = function (e) {
                    console.log(reader.result);
                    $('#profile').css('background-image', 'url(' + reader.result + ')').addClass('hasImage');
                }
            }
        })
    </Script>
}
